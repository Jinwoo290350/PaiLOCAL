# üìò Plan My Trip - Comprehensive Usage Guide

## ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç (Table of Contents)

1. [‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö (System Overview)](#‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö-system-overview)
2. [‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏° (Architecture)](#‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°-architecture)
3. [‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (How to Use)](#‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô-how-to-use)
4. [‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (Components Details)](#‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö-components-details)
5. [‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢ (Pros and Cons)](#‡∏Ç‡∏≠‡∏î‡∏Ç‡∏≠‡πÄ‡∏™‡∏¢-pros-and-cons)
6. [‡∏Å‡∏≤‡∏£ Deploy (Deployment)](#‡∏Å‡∏≤‡∏£-deploy-deployment)
7. [Troubleshooting](#troubleshooting)

---

## ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö (System Overview)

### ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**Plan My Trip** ‡πÄ‡∏õ‡πá‡∏ô AI-powered Trip Planning System ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢ ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢:
- **‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß** ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å Theme ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà
- **‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û** (Image Search) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ô
- **‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Carbon Footprint** ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ Eco Score
- **‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á** ‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏±‡∏•‡∏Å‡∏≠‡∏£‡∏¥‡∏ó‡∏∂‡∏° 2-opt

### ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏´‡∏•‡∏±‡∏Å

**Backend:**
- FastAPI (Python 3.13)
- Pandas (Data manipulation)
- Rule-based scoring (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ ML models)
- In-memory data storage

**Frontend:**
- Vanilla JavaScript + HTML5 + CSS3
- Leaflet.js (Interactive maps)
- Responsive design

**Data Source:**
- CSV file: `chiang_rai_featured.csv` (1,055 places)
- 12 keyword categories (‡∏ü‡∏≤‡∏£‡πå‡∏°, ‡πÇ‡∏Æ‡∏°‡∏™‡πÄ‡∏ï‡∏¢‡πå, ‡∏à‡∏∏‡∏î‡∏ä‡∏°‡∏ß‡∏¥‡∏ß, etc.)
- Photos stored in Google Drive

---

## ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏° (Architecture)

### Directory Structure

```
AI/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ app.py                    # Main FastAPI app
‚îÇ   ‚îú‚îÄ‚îÄ config.py                 # Configuration & themes
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt          # Python dependencies
‚îÇ   ‚îú‚îÄ‚îÄ start.sh / start.bat      # Startup scripts
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes.py            # API endpoints
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schemas.py           # Pydantic models
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trip_planner.py      # Core trip planning logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ route_optimizer.py   # Route optimization (2-opt)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ carbon_calculator.py # Carbon & eco score
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data_loader.py       # CSV data loader
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ image_similarity.py  # Image search
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ geo_utils.py         # Haversine distance
‚îÇ       ‚îî‚îÄ‚îÄ photo_utils.py       # Google Drive photo handling
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ index.html               # Theme search page
‚îÇ   ‚îú‚îÄ‚îÄ image-search.html        # Image search page
‚îÇ   ‚îú‚îÄ‚îÄ app.js                   # Theme search JS
‚îÇ   ‚îú‚îÄ‚îÄ image-search.js          # Image search JS
‚îÇ   ‚îî‚îÄ‚îÄ style.css                # Shared styles
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ chiang_rai_featured.csv  # Places data (1,055 rows)
‚îî‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ README.md
    ‚îú‚îÄ‚îÄ QUICKSTART.md
    ‚îú‚îÄ‚îÄ IMAGE_SEARCH_README.md
    ‚îî‚îÄ‚îÄ COMPREHENSIVE_USAGE_GUIDE.md (this file)
```

### Data Flow

```
User Input ‚Üí Frontend ‚Üí FastAPI Backend ‚Üí Services ‚Üí Data Processing ‚Üí Response
                                              ‚Üì
                                         DataFrame
                                      (In-Memory CSV)
```

---

## ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (How to Use)

### 1. Setup & Installation

#### Step 1: Clone & Navigate
```bash
cd /path/to/PaiLOCAL/AI/backend
```

#### Step 2: Create Virtual Environment
```bash
python3 -m venv venv
source venv/bin/activate  # macOS/Linux
# ‡∏´‡∏£‡∏∑‡∏≠
venv\Scripts\activate     # Windows
```

#### Step 3: Install Dependencies
```bash
pip install -r requirements.txt
```

**‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á:** ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Python 3.13+ ‡πÅ‡∏•‡∏∞ pandas>=2.2.0

#### Step 4: Start Server
```bash
# ‡πÉ‡∏ä‡πâ startup script (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
./start.sh              # macOS/Linux
start.bat               # Windows

# ‡∏´‡∏£‡∏∑‡∏≠ manual
uvicorn app:app --reload --host 0.0.0.0 --port 8000
```

‡πÄ‡∏õ‡∏¥‡∏î browser ‡πÑ‡∏õ‡∏ó‡∏µ‡πà:
- API Docs: http://localhost:8000/docs
- Theme Search: `file:///path/to/AI/frontend/index.html`
- Image Search: `file:///path/to/AI/frontend/image-search.html`

---

### 2. ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Theme Search (index.html)

#### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:

1. **‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Mode:**
   - **Theme-based**: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡πÉ‡∏ô 6 themes (Naturalist, Conservative, Photogenic, Cafeist, Mood, Weather)
   - **Place Name-based**: ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏ä‡πà‡∏ô "‡∏™‡∏¥‡∏á‡∏´‡πå‡∏õ‡∏≤‡∏£‡πå‡∏Ñ", "‡∏î‡∏≠‡∏¢‡πÅ‡∏°‡πà‡∏™‡∏•‡∏≠‡∏á")

2. **‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:**
   - Latitude: ‡πÄ‡∏ä‡πà‡∏ô 19.9105 (‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡∏≠‡∏á)
   - Longitude: ‡πÄ‡∏ä‡πà‡∏ô 99.8406

3. **‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå:**
   - Number of Stops: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà (1-20)
   - Max Distance: ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (km)

4. **‡∏Ñ‡∏•‡∏¥‡∏Å "Plan My Trip"**

5. **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
   - ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á (Leaflet.js)
   - ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:
     - ‡∏ä‡∏∑‡πà‡∏≠, Keyword, Rating
     - ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
     - ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏™‡∏∞‡∏™‡∏°‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
     - Carbon footprint
     - ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û 1-3 ‡∏£‡∏π‡∏õ
   - ‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏£‡∏¥‡∏õ: Total distance, Carbon, Eco Score

---

### 3. ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Image Search (image-search.html)

#### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:

1. **Upload ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:**
   - Drag & Drop ‡∏£‡∏π‡∏õ‡∏•‡∏á‡πÉ‡∏ô Upload Zone
   - ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
   - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: JPG, PNG, WebP

2. **‡∏î‡∏π Preview** ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏¥‡∏Å **"üîç Find Similar Places"**

3. **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ:**
   - Top 5 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ô
   - ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á:
     - ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û thumbnail
     - ‡∏ä‡∏∑‡πà‡∏≠, Keyword
     - Rating & Reviews
     - **Similarity Score** (% ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢)

4. **‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:**
   - ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
   - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∞‡∏°‡∏µ highlight ‡∏™‡∏µ‡∏ü‡πâ‡∏≤
   - **Selected Places Summary** ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (1-5)

5. **‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏£‡∏¥‡∏õ:**
   - ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (Lat/Lng)
   - ‡∏Ñ‡∏•‡∏¥‡∏Å **"Plan Trip with Selected Places"**
   - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

---

## ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (Components Details)

### Backend Services

#### 1. TripPlanner (services/trip_planner.py)

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡∏à‡∏≤‡∏Å Theme ‡∏´‡∏£‡∏∑‡∏≠ Place Name

**‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡∏ó‡∏≥‡πÑ‡∏á:**
```python
from services.trip_planner import TripPlanner

planner = TripPlanner(dataframe)
result = planner.plan_trip(
    start_lat=19.9105,
    start_lng=99.8406,
    mode="theme",          # ‡∏´‡∏£‡∏∑‡∏≠ "place_name"
    value="naturalist",    # theme name ‡∏´‡∏£‡∏∑‡∏≠ place name
    num_stops=5,
    max_distance_km=100
)
```

**‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£:**
1. **Filter places** ‡∏ï‡∏≤‡∏° mode (theme keywords ‡∏´‡∏£‡∏∑‡∏≠ name similarity)
2. **Score places** ‡∏î‡πâ‡∏ß‡∏¢ rule-based formula:
   ```
   score = (tourism_score √ó 0.30) +
           (rating √ó 0.20) +
           (carbon_score √ó 0.25) +
           (popularity √ó 0.15) +
           (distance_score √ó 0.10)
   ```
3. **Select top-N places** ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
4. **Optimize route** ‡∏î‡πâ‡∏ß‡∏¢ RouteOptimizer
5. **Calculate carbon & eco score**

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- Fast (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á train model)
- Transparent (‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô)
- Customizable (‡πÅ‡∏Å‡πâ weight ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢)

**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ" ‡∏à‡∏≤‡∏Å‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
- Scoring formula ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö manual
- ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ capture complex patterns

---

#### 2. RouteOptimizer (services/route_optimizer.py)

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏™‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

**‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡∏ó‡∏≥‡πÑ‡∏á:**
```python
from services.route_optimizer import RouteOptimizer

route = RouteOptimizer.optimize_route(
    start_lat=19.9105,
    start_lng=99.8406,
    places_df=selected_places
)
# Returns: [(index, dist_from_prev, dist_from_start), ...]
```

**‡∏≠‡∏±‡∏•‡∏Å‡∏≠‡∏£‡∏¥‡∏ó‡∏∂‡∏°:**
1. **Greedy Nearest Neighbor:**
   - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
   - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°
   - ‡∏ó‡∏≥‡∏ã‡πâ‡∏≥‡∏à‡∏ô‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

2. **2-opt Improvement:**
   - ‡∏•‡∏≠‡∏á reverse segments ‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
   - ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏•‡∏î‡∏•‡∏á ‚Üí ‡πÉ‡∏ä‡πâ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
   - ‡∏ó‡∏≥‡∏ã‡πâ‡∏≥‡∏à‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÑ‡∏î‡πâ

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
```
Initial: A ‚Üí B ‚Üí D ‚Üí C ‚Üí E (distance: 120 km)
                ‚Üì
         A ‚Üí B ‚Üí C ‚Üí D ‚Üí E (distance: 95 km)  ‚úÖ Better!
```

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‡∏•‡∏î zig-zag patterns ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å
- Fast (O(n¬≤) per iteration)
- ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏±‡∏ö 5-20 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà

**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà optimal solution (TSP is NP-hard)
- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö >50 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà ‡∏≠‡∏≤‡∏à‡∏ä‡πâ‡∏≤
- ‡πÑ‡∏°‡πà consider ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î, traffic

**‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∑‡πà‡∏ô:**
- Genetic Algorithm (‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ ‡πÅ‡∏ï‡πà‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤)
- Simulated Annealing
- Christofides Algorithm
- Google OR-Tools

---

#### 3. CarbonCalculator (services/carbon_calculator.py)

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Carbon Footprint ‡πÅ‡∏•‡∏∞ Eco Score

**‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡∏ó‡∏≥‡πÑ‡∏á:**
```python
from services.carbon_calculator import CarbonCalculator

carbon = CarbonCalculator.calculate_place_carbon(place_row, distance_km)
# Returns: float (kg CO2)

eco_score = CarbonCalculator.calculate_eco_score(
    total_carbon=45.5,
    avg_tourism_score=8.2,
    avg_rating=4.5,
    route_efficiency=0.85
)
# Returns: float (0-10)
```

**‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Carbon:**
```python
transport_carbon = distance_km √ó 0.12  # kg CO2/km (car)
activity_carbon = activity_carbon_score √ó 0.5
visitor_carbon = visitor_carbon_factor
total = transport_carbon + activity_carbon + visitor_carbon
```

**‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Eco Score (0-10):**
```python
carbon_score = max(0, 10 - (total_carbon / 10))
tourism_score_normalized = avg_tourism_score
rating_score = avg_rating √ó 2
efficiency_score = route_efficiency √ó 10

eco_score = (carbon_score √ó 0.35 +
             tourism_score_normalized √ó 0.25 +
             rating_score √ó 0.25 +
             efficiency_score √ó 0.15)
```

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- Simple ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢
- ‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏° eco-friendly tourism
- Adjustable weights

**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- Carbon factors ‡πÄ‡∏õ‡πá‡∏ô estimated values
- ‡πÑ‡∏°‡πà consider ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏¢‡∏≤‡∏ô‡∏û‡∏≤‡∏´‡∏ô‡∏∞
- Activity carbon ‡πÄ‡∏õ‡πá‡∏ô rough estimate

**‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á:**
- ‡πÉ‡∏´‡πâ user ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ (car, EV, bike)
- ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• real-time carbon data
- ‡πÄ‡∏û‡∏¥‡πà‡∏° offset options

---

#### 4. ImageSimilaritySearch (services/image_similarity.py)

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà upload

**‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡∏ó‡∏≥‡πÑ‡∏á:**
```python
from services.image_similarity import ImageSimilaritySearch

search = ImageSimilaritySearch()
results = search.search_similar_places(
    image_bytes=uploaded_image,
    top_k=5
)
# Returns: DataFrame with similarity scores
```

**Current Implementation (Simple):**
- Extract color histogram ‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ
- Score places based on:
  - Tourism score
  - Rating
  - Popularity
  - Random factor (for demo)
- Return top-K results

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ ML model
- Fast
- No GPU required

**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- **‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å**
- ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏π‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á‡πÜ
- ‡πÄ‡∏õ‡πá‡∏ô mock implementation

---

**Production Implementation (Recommended):**

```python
# Install: pip install transformers torch

from transformers import CLIPProcessor, CLIPModel
import torch

# Load model
model = CLIPModel.from_pretrained("openai/clip-vit-base-patch32")
processor = CLIPProcessor.from_pretrained("openai/clip-vit-base-patch32")

# Extract image embedding
image = Image.open(image_path)
inputs = processor(images=image, return_tensors="pt")
image_features = model.get_image_features(**inputs)

# Compare with pre-computed place embeddings
similarities = torch.cosine_similarity(image_features, place_embeddings)
top_k_indices = similarities.topk(k=5)
```

**CLIP Approach ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å (state-of-the-art)
- ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ (mountains, temples, farms)
- Pre-trained ‡∏ö‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• billions of images

**CLIP Approach ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ ML infrastructure
- ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ GPU (‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡πâ‡∏≤‡∏°‡∏≤‡∏Å)
- ‡∏ï‡πâ‡∏≠‡∏á pre-compute embeddings ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏π‡∏õ‡πÉ‡∏ô database
- Model size ~600MB

---

#### 5. PhotoUtils (utils/photo_utils.py)

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ photo URLs ‡∏à‡∏≤‡∏Å Google Drive

**‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡∏ó‡∏≥‡πÑ‡∏á:**
```python
from utils.photo_utils import get_place_photos

photos = get_place_photos(place_row, use_placeholders=True)
# Returns: ["url1", "url2", "url3"] ‡∏´‡∏£‡∏∑‡∏≠ placeholders
```

**Current Implementation:**
- Check ‡∏ñ‡πâ‡∏≤ photo column ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤
- Check ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô full URL ‚Üí ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô filename ‚Üí Return placeholder ‡∏û‡∏£‡πâ‡∏≠‡∏° keyword
- Placeholder format: `https://via.placeholder.com/400x300/667eea/ffffff?text={keyword}`

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ï‡∏Å (broken images)
- Professional appearance
- Shows keyword (user ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∞‡πÑ‡∏£)

**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á
- User experience ‡πÑ‡∏°‡πà‡∏î‡∏µ‡πÄ‡∏ó‡πà‡∏≤‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á

---

**Production Implementation:**

**Step 1: Setup Google Drive API**
```bash
pip install google-api-python-client google-auth
```

**Step 2: Get Service Account Credentials**
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Google Cloud Console
2. Create Service Account
3. Download JSON key file
4. Share Google Drive folder ‡∏Å‡∏±‡∏ö service account email

**Step 3: Create Photo Mapping**
```python
from googleapiclient.discovery import build
from google.oauth2 import service_account
import json

# Authenticate
credentials = service_account.Credentials.from_service_account_file(
    'service-account-key.json',
    scopes=['https://www.googleapis.com/auth/drive.readonly']
)

service = build('drive', 'v3', credentials=credentials)

# List files in folder
folder_id = "1RWlpDybqGllqeIIKuNOTNkwvcgpcnf7X"
results = service.files().list(
    q=f"'{folder_id}' in parents",
    fields="files(id, name)"
).execute()

# Create mapping
file_mapping = {
    file['name']: file['id']
    for file in results.get('files', [])
}

# Save to JSON
with open('photo_mapping.json', 'w') as f:
    json.dump(file_mapping, f)
```

**Step 4: Update photo_utils.py**
```python
import json

# Load mapping
with open('photo_mapping.json') as f:
    PHOTO_MAPPING = json.load(f)

def get_photo_url_from_filename(filename):
    if filename in PHOTO_MAPPING:
        file_id = PHOTO_MAPPING[filename]
        return f"https://drive.google.com/uc?export=view&id={file_id}"
    return None
```

**Google Drive API ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Drive
- Centralized storage
- Easy to update photos

**Google Drive API ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- ‡∏ï‡πâ‡∏≠‡∏á setup credentials
- Requires API calls (quota limits)
- Slower ‡∏Å‡∏ß‡πà‡∏≤ CDN

**‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∑‡πà‡∏ô:**
- **Cloudinary**: Image optimization + CDN
- **AWS S3 + CloudFront**: Scalable, fast
- **Firebase Storage**: Easy integration
- **Imgur API**: Free tier available

---

### Frontend Components

#### 1. Theme Search (index.html + app.js)

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** UI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö theme-based ‡πÅ‡∏•‡∏∞ place-name-based trip planning

**Features:**
- Mode selection (theme/place name)
- Input validation
- Interactive map (Leaflet.js)
- Photo display (1-3 photos per place)
- Route visualization
- Trip summary

**Key Functions:**

```javascript
// Plan trip
async function planTrip() {
    const response = await fetch('http://localhost:8000/api/plan-trip', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(tripData)
    });
    const result = await response.json();
    displayResults(result);
}

// Display map
function displayMap(places) {
    const map = L.map('map').setView([startLat, startLng], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // Add markers & route
    places.forEach((place, idx) => {
        L.marker([place.lat, place.lng])
            .bindPopup(`${idx + 1}. ${place.name}`)
            .addTo(map);
    });
}
```

---

#### 2. Image Search (image-search.html + image-search.js)

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** Upload image ‡πÅ‡∏•‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ô

**Features:**
- Drag & Drop file upload
- Image preview
- Similar places display
- **Selected places summary** (‡πÅ‡∏™‡∏î‡∏á 1-5 ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)
- Multi-selection
- Trip planning from selected places

**Key Functions:**

```javascript
// Upload & search
async function searchSimilarPlaces() {
    const formData = new FormData();
    formData.append('image', selectedFile);
    formData.append('top_k', 5);

    const response = await fetch('http://localhost:8000/api/image-search', {
        method: 'POST',
        body: formData
    });
    const result = await response.json();
    displaySimilarPlaces(result.results);
}

// Update selected summary
function updateSelectedSummary() {
    const summaryDiv = document.getElementById('selected-summary');
    if (selectedPlaces.size === 0) {
        summaryDiv.style.display = 'none';
        return;
    }

    summaryDiv.style.display = 'block';
    const selectedArray = Array.from(selectedPlaces).sort((a, b) => a - b);
    const listHTML = selectedArray.map((index, order) => {
        const place = similarPlacesData[index];
        return `<div>${order + 1}. ${place.name} (${place.keyword})</div>`;
    }).join('');

    document.getElementById('selected-list').innerHTML = listHTML;
}
```

---

## ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢ (Pros and Cons)

### Rule-Based vs ML Approach

| Aspect | Rule-Based (Current) | ML-Based |
|--------|---------------------|----------|
| **Development Time** | üü¢ Fast (1-2 days) | üî¥ Slow (weeks-months) |
| **Accuracy** | üü° Good (70-80%) | üü¢ Better (85-95%) |
| **Explainability** | üü¢ Transparent | üî¥ Black box |
| **Maintenance** | üü¢ Easy | üü° Requires retraining |
| **Infrastructure** | üü¢ Simple (CPU only) | üî¥ Complex (GPU, training pipeline) |
| **Customization** | üü¢ Easy (edit weights) | üî¥ Hard (retrain model) |
| **Scalability** | üü¢ Linear | üü° Requires optimization |
| **Data Requirements** | üü¢ Works with 1K rows | üî¥ Needs 10K+ labeled data |

**‡∏™‡∏£‡∏∏‡∏õ:** Rule-based approach ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö MVP ‡πÅ‡∏•‡∏∞ dataset ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å-‡∏Å‡∏•‡∏≤‡∏á

---

### In-Memory vs Database

| Aspect | In-Memory (Current) | Database |
|--------|---------------------|----------|
| **Speed** | üü¢ Very Fast (< 10ms) | üü° Fast (10-50ms) |
| **Scalability** | üî¥ Limited (< 10K rows) | üü¢ Unlimited |
| **Data Updates** | üî¥ Requires restart | üü¢ Real-time |
| **Complexity** | üü¢ Simple | üü° Moderate |
| **Concurrency** | üü° Read-only safe | üü¢ ACID transactions |
| **Memory Usage** | üî¥ High (all data in RAM) | üü¢ Efficient |
| **Deployment** | üü¢ Single file | üü° Separate service |

**‡∏™‡∏£‡∏∏‡∏õ:** In-memory ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö read-heavy, static data. ‡∏ñ‡πâ‡∏≤ data ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ö‡πà‡∏≠‡∏¢ ‚Üí ‡πÉ‡∏ä‡πâ Database

---

### 2-opt vs Other TSP Algorithms

| Algorithm | Time Complexity | Quality | Use Case |
|-----------|----------------|---------|----------|
| **Greedy NN** | O(n¬≤) | üü° Fair | Quick & dirty |
| **2-opt** (Current) | O(n¬≤) per iteration | üü¢ Good | 5-50 places |
| **3-opt** | O(n¬≥) per iteration | üü¢ Better | 10-30 places |
| **Genetic Algorithm** | O(n¬≤ √ó generations) | üü¢ Very Good | 20-100 places |
| **Christofides** | O(n¬≥) | üü¢ Guaranteed 1.5√ó optimal | Academic/research |
| **Exact (Branch & Bound)** | O(n!) | üü¢ Optimal | < 20 places only |
| **Google OR-Tools** | Depends | üü¢ Excellent | Production |

**‡∏™‡∏£‡∏∏‡∏õ:** 2-opt ‡πÄ‡∏õ‡πá‡∏ô sweet spot ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û

---

### Placeholder vs Real Photos

| Aspect | Placeholder (Current) | Google Drive API | CDN (S3/Cloudinary) |
|--------|---------------------|------------------|---------------------|
| **Setup Time** | üü¢ 0 minutes | üü° 1-2 hours | üü° 30 minutes |
| **Cost** | üü¢ Free | üü¢ Free (quota) | üî¥ Paid |
| **Speed** | üü¢ Fast | üü° Medium | üü¢ Very Fast |
| **Image Quality** | üî¥ Generic | üü¢ Real | üü¢ Optimized |
| **Maintenance** | üü¢ Zero | üü° Medium | üü¢ Low |
| **UX** | üü° Acceptable for demo | üü¢ Good | üü¢ Excellent |

**‡∏™‡∏£‡∏∏‡∏õ:** Placeholder ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö demo/MVP, production ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ CDN

---

### Color Histogram vs CLIP Embeddings

| Aspect | Color Histogram (Current) | CLIP Embeddings |
|--------|--------------------------|-----------------|
| **Accuracy** | üî¥ Poor (30-40%) | üü¢ Excellent (85-95%) |
| **Setup** | üü¢ Easy | üî¥ Complex |
| **Speed** | üü¢ Fast (< 100ms) | üü° Medium (500ms without GPU) |
| **Requirements** | üü¢ CPU only | üî¥ GPU recommended |
| **Model Size** | üü¢ 0 MB | üî¥ ~600 MB |
| **Understanding** | üî¥ Colors only | üü¢ Semantic content |
| **Cost** | üü¢ Free | üü° Cloud GPU costs |

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
- **Color Histogram**: ‡∏£‡∏π‡∏õ‡∏ü‡πâ‡∏≤‡∏™‡∏µ‡∏ü‡πâ‡∏≤ = ‡∏ó‡∏∏‡∏Å‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ü‡πâ‡∏≤‡∏™‡∏µ‡∏ü‡πâ‡∏≤ (‡πÑ‡∏°‡πà‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏±‡∏î)
- **CLIP**: ‡∏£‡∏π‡∏õ‡∏ß‡∏±‡∏î = ‡∏´‡∏≤‡∏ß‡∏±‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à semantic meaning)

**‡∏™‡∏£‡∏∏‡∏õ:** CLIP ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö production, Color Histogram ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö demo ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

---

## ‡∏Å‡∏≤‡∏£ Deploy (Deployment)

### 1. Local Development

```bash
# Already covered in "How to Use"
cd AI/backend
source venv/bin/activate
./start.sh
```

---

### 2. Production Deployment Options

#### Option A: Traditional VPS (DigitalOcean, Linode, etc.)

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- Full control
- Simple deployment
- Predictable costs

**Steps:**
```bash
# 1. Setup server
ssh user@your-server-ip

# 2. Install dependencies
sudo apt update
sudo apt install python3.13 python3.13-venv nginx

# 3. Clone repo
git clone <your-repo>
cd AI/backend

# 4. Setup venv & install
python3.13 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 5. Run with systemd
sudo nano /etc/systemd/system/tripplanner.service
```

**tripplanner.service:**
```ini
[Unit]
Description=Plan My Trip API
After=network.target

[Service]
User=www-data
WorkingDirectory=/path/to/AI/backend
ExecStart=/path/to/venv/bin/uvicorn app:app --host 0.0.0.0 --port 8000
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
# 6. Enable & start
sudo systemctl enable tripplanner
sudo systemctl start tripplanner

# 7. Setup Nginx reverse proxy
sudo nano /etc/nginx/sites-available/tripplanner
```

**Nginx config:**
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

```bash
# 8. Enable site & restart Nginx
sudo ln -s /etc/nginx/sites-available/tripplanner /etc/nginx/sites-enabled/
sudo systemctl restart nginx
```

---

#### Option B: Docker

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- Consistent environment
- Easy scaling
- Better for CI/CD

**Dockerfile:**
```dockerfile
FROM python:3.13-slim

WORKDIR /app

# Install dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy app
COPY . .

# Run
CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8000"]
```

**docker-compose.yml:**
```yaml
version: '3.8'

services:
  api:
    build: ./backend
    ports:
      - "8000:8000"
    volumes:
      - ./data:/app/data
    environment:
      - PYTHONUNBUFFERED=1
    restart: always

  frontend:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./frontend:/usr/share/nginx/html
    restart: always
```

**Deploy:**
```bash
docker-compose up -d
```

---

#### Option C: Cloud Platforms

##### 1. Heroku
```bash
# Procfile
web: uvicorn app:app --host 0.0.0.0 --port $PORT

# Deploy
heroku create your-app-name
git push heroku main
```

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:** Easy deployment
**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:** Expensive for production

---

##### 2. AWS Elastic Beanstalk
```bash
# Install EB CLI
pip install awsebcli

# Initialize
eb init -p python-3.13 trip-planner

# Create environment
eb create trip-planner-env

# Deploy
eb deploy
```

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:** Auto-scaling, managed
**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:** More complex

---

##### 3. Google Cloud Run (Recommended for small-medium traffic)

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- Serverless (pay per request)
- Auto-scaling
- Easy deployment

**Steps:**
```bash
# 1. Install gcloud CLI
# 2. Build container
gcloud builds submit --tag gcr.io/YOUR_PROJECT_ID/trip-planner

# 3. Deploy
gcloud run deploy trip-planner \
  --image gcr.io/YOUR_PROJECT_ID/trip-planner \
  --platform managed \
  --region asia-southeast1 \
  --allow-unauthenticated
```

**Cost Estimate:**
- 0-1M requests: ~$0
- 1-10M requests: ~$50-200/month

---

### 3. Database Migration (Optional)

**‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡∏ï‡πâ‡∏≠‡∏á migrate:**
- Data > 10K rows
- Frequent updates
- Multiple concurrent writes
- Need data versioning

**Recommended: PostgreSQL**

```bash
# Install
pip install sqlalchemy psycopg2-binary

# Update data_loader.py
from sqlalchemy import create_engine
import pandas as pd

class DataLoader:
    def __init__(self, db_url):
        self.engine = create_engine(db_url)

    def get_data(self):
        return pd.read_sql("SELECT * FROM places", self.engine)
```

---

### 4. Monitoring & Logging

#### Add Logging to app.py:
```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('app.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)
```

#### Production Monitoring Tools:
- **Sentry**: Error tracking
- **Prometheus + Grafana**: Metrics
- **ELK Stack**: Log aggregation

---

## Troubleshooting

### Common Issues

#### 1. ModuleNotFoundError
```
ModuleNotFoundError: No module named 'fastapi'
```

**Solution:**
```bash
# Check if venv is activated
which python  # Should show venv path

# Reinstall
pip install -r requirements.txt
```

---

#### 2. Port Already in Use
```
ERROR: [Errno 48] Address already in use
```

**Solution:**
```bash
# Find process
lsof -i :8000

# Kill process
kill -9 <PID>

# Or use different port
uvicorn app:app --port 8001
```

---

#### 3. CORS Error
```
Access to fetch blocked by CORS policy
```

**Solution:** Already configured in [app.py:23-30](AI/backend/app.py#L23-L30)
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_methods=["*"],
    allow_headers=["*"]
)
```

---

#### 4. CSV File Not Found
```
FileNotFoundError: chiang_rai_featured.csv
```

**Solution:**
```bash
# Check path
ls AI/data/chiang_rai_featured.csv

# Update DATA_FILE in app.py if needed
DATA_FILE = "../data/chiang_rai_featured.csv"
```

---

#### 5. Pandas Compatibility Issue
```
ImportError: cannot import name '_maybe_promote'
```

**Solution:**
```bash
# Update pandas
pip install --upgrade pandas>=2.2.0
```

---

#### 6. Photos Not Showing
**Symptoms:** Placeholder images instead of real photos

**Cause:** CSV contains filenames, not URLs

**Solution Options:**

**Option 1: Use placeholders (current)**
- Already implemented
- Good for demo

**Option 2: Setup Google Drive API**
- Follow instructions in [photo_utils.py:84-145](AI/backend/utils/photo_utils.py#L84-L145)

**Option 3: Move photos to CDN**
```bash
# Upload to Cloudinary
for file in photos/*; do
    curl -X POST https://api.cloudinary.com/v1_1/YOUR_CLOUD/upload \
      -F "file=@$file" \
      -F "upload_preset=YOUR_PRESET"
done
```

---

#### 7. Image Search Returns Random Results
**Cause:** Current implementation uses color histogram (mock)

**Solution:** Implement CLIP embeddings (see [Components Details - ImageSimilaritySearch](#4-imagesimilaritysearch-servicesimage_similaritypy))

---

#### 8. Route Still Inefficient
**Possible causes:**
- Not enough iterations (default: 100)
- Dataset characteristics

**Solution:**
```python
# Increase max_iterations in route_optimizer.py:95
def _two_opt_improvement(..., max_iterations=200):  # Default was 100
```

---

## Performance Optimization Tips

### 1. Caching

```python
from functools import lru_cache

@lru_cache(maxsize=100)
def calculate_distance(lat1, lng1, lat2, lng2):
    return haversine_distance(lat1, lng1, lat2, lng2)
```

---

### 2. Pre-compute Place Embeddings (for Image Search)

```python
# One-time script
import pickle
from services.image_similarity import ImageSimilaritySearch

search = ImageSimilaritySearch()
embeddings = {}

for idx, row in df.iterrows():
    if row['photo_1']:
        embeddings[row['place_id']] = search.extract_embedding(row['photo_1'])

with open('place_embeddings.pkl', 'wb') as f:
    pickle.dump(embeddings, f)
```

---

### 3. Use uvloop (Faster async)

```bash
pip install uvloop
```

```python
# In app.py
import uvloop
uvloop.install()
```

---

## Next Steps

### Immediate (Demo ‚Üí MVP)
1. ‚úÖ Fix route optimization (Done)
2. ‚úÖ Add selected places summary (Done)
3. ‚¨ú Setup Google Drive photo mapping
4. ‚¨ú Deploy to cloud (Cloud Run recommended)
5. ‚¨ú Add error handling & logging

### Short-term (MVP ‚Üí Production)
1. ‚¨ú Implement CLIP for image search
2. ‚¨ú Add user authentication
3. ‚¨ú Migrate to PostgreSQL
4. ‚¨ú Add caching (Redis)
5. ‚¨ú Setup monitoring (Sentry)

### Long-term (Production ‚Üí Scale)
1. ‚¨ú ML-based personalized recommendations
2. ‚¨ú Multi-day trip planning
3. ‚¨ú Real-time traffic integration
4. ‚¨ú Mobile app (Flutter/React Native)
5. ‚¨ú Social features (share trips, reviews)

---

## Summary

| Component | What It Does | When to Use | Production Ready? |
|-----------|--------------|-------------|-------------------|
| **TripPlanner** | ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡∏î‡πâ‡∏ß‡∏¢ rule-based scoring | Theme/place-based planning | üü¢ Yes (MVP) |
| **RouteOptimizer** | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á (2-opt) | 5-50 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà | üü¢ Yes |
| **CarbonCalculator** | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì carbon & eco score | ‡∏ó‡∏∏‡∏Å‡∏ó‡∏£‡∏¥‡∏õ | üü° Need real data |
| **ImageSimilarity** | ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ | Image search feature | üî¥ Need CLIP |
| **PhotoUtils** | ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ photo URLs | Photo display | üü° Need Google Drive API |
| **In-Memory Storage** | ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô RAM | < 10K rows, read-heavy | üü¢ Yes (small scale) |
| **Placeholder Images** | ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ generic | Demo/development | üü° MVP only |

---

## Contact & Support

- **GitHub Issues**: [Report bugs](https://github.com/your-repo/issues)
- **Documentation**: [README.md](README.md), [QUICKSTART.md](QUICKSTART.md)
- **API Docs**: http://localhost:8000/docs (when running)

---

**‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠:** 2025-10-30
**Version:** 1.0
**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** Production-Ready for MVP, Need Enhancements for Scale

